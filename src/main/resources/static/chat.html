<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SpringConnect â€” WebSocket Fusion</title>
<style>
:root{--bg:#0f1724;--card:#0b1220;--accent:#6ee7b7;--muted:#98a0b3;--me:#074e3b;--other:#102a43;--glass:rgba(255,255,255,0.04);}
html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;}
body{display:flex;align-items:center;justify-content:center;background: radial-gradient(1200px 600px at 10% 10%, rgba(110,231,183,0.06), transparent 8%),linear-gradient(180deg,#071021 0%, #071428 50%, #0a1220 100%);color:#e6eef6;}
.chat-card{width:92%;max-width:920px;height:76vh;border-radius:14px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));box-shadow:0 10px 30px rgba(2,6,23,0.75);display:flex;overflow:hidden;border:1px solid rgba(255,255,255,0.03);}
.sidebar{width:240px;padding:18px;border-right:1px solid rgba(255,255,255,0.02);display:flex;flex-direction:column;gap:12px;background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(255,255,255,0.00));}
.brand{font-weight:700;font-size:1.05rem;display:flex;align-items:center;gap:10px;}
.logo{width:36px;height:36px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#34d399);display:flex;align-items:center;justify-content:center;color:#052018;font-weight:700;box-shadow:0 4px 10px rgba(110,231,183,0.08);}
.users{margin-top:6px;display:flex;flex-direction:column;gap:8px;}
.user{display:flex;align-items:center;gap:10px;padding:8px;border-radius:10px;transition:transform .15s ease, background .15s ease;}
.user:hover{transform:translateX(6px);background:var(--glass);}
.avatar{width:36px;height:36px;border-radius:8px;background:#0b2233;display:flex;align-items:center;justify-content:center;font-weight:600;color:var(--accent);}
.main{flex:1;display:flex;flex-direction:column;}
.header{padding:16px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid rgba(255,255,255,0.02);}
.status{font-size:0.85rem;color:var(--muted);}
.messages{padding:18px;flex:1;overflow:auto;display:flex;flex-direction:column;gap:12px;}
.msg{max-width:74%;padding:10px 14px;border-radius:14px;box-shadow:0 6px 18px rgba(2,6,23,0.45);}
.msg.me{margin-left:auto;background:linear-gradient(180deg,var(--me), #065f48);color:#e6fff3;}
.msg.other{margin-right:auto;background:linear-gradient(180deg,var(--other), #123444);color:#eaf6ff;}
.meta{font-size:0.72rem;color:rgba(255,255,255,0.6);margin-bottom:6px;}
.text{white-space:pre-wrap;font-size:0.95rem;}
.time{font-size:0.68rem;color:var(--muted);margin-top:8px;text-align:right;}
.composer{padding:12px 16px;border-top:1px solid rgba(255,255,255,0.02);display:flex;gap:10px;align-items:center;}
.input{flex:1;display:flex;gap:8px;align-items:center;background:rgba(255,255,255,0.02);padding:8px;border-radius:12px;}
.input input{flex:1;background:transparent;border:none;color:inherit;padding:8px;font-size:0.95rem;outline:none;}
.btn{background:var(--accent);border:none;padding:10px 14px;border-radius:10px;font-weight:600;color:#052018;cursor:pointer;}
.btn:active{transform:scale(.98);}
</style>
</head>
<body>
<div class="chat-card">
  <aside class="sidebar">
    <div class="brand"><div class="logo">SC</div><div><div>SpringConnect</div><div class="subtitle">WebSocket Fusion</div></div></div>
    <div class="users" id="userList"></div>

    
    <div style="
    margin-top: auto;
    font-size: 0.95rem;
    color: #f1f1f1; /* brighter color */
    background-color: rgba(0, 0, 0, 0.5); /* semi-transparent background */
    padding: 5px 10px;
    border-radius: 5px;
">
  Tip: Open another tab to chat live. 
  <a href="http://localhost:8080/chat.html" target="_blank" style="color: #c94b08; text-decoration: underline;">
    Visit Link
  </a>
</div>

  </aside>
  <section class="main">
    <div class="header">
      <div>
        <h2 style="font-family:Poppins,sans-serif;color:#00bfa6;text-shadow:1px 1px 8px rgba(0,0,0,0.2);">ðŸŒ¿ SpringConnect â€” WS</h2>
        <div class="status" id="connStatus">Connecting...</div>
      </div>
    </div>
    <div class="messages" id="messages"></div>
    <div class="composer">
      <div class="input"><input id="inputMsg" type="text" placeholder="Type a message and press Enter..."/></div>
      <button class="btn" id="sendBtn">Send</button>
    </div>
  </section>
</div>

<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>

<script>
let me = prompt("Enter your name:", "Guest") || "Guest";
let stompClient = null;
const userListDiv = document.getElementById("userList");

function connect() {
  const socket = new SockJS("/ws");
  stompClient = Stomp.over(socket);

  stompClient.connect({}, function () {
    document.getElementById("connStatus").textContent = "Connected";
    stompClient.subscribe("/topic/public", function (msg) {
      showMessage(JSON.parse(msg.body));
    });
    stompClient.subscribe("/topic/users", function (msg) {
      updateUserList(JSON.parse(msg.body));
    });
    // notify backend about new user
    stompClient.send("/app/newUser", {}, JSON.stringify({ sender: me }));

  });
}

function updateUserList(userArray) {
  userListDiv.innerHTML = "";
  userArray.forEach(username => {
    userListDiv.innerHTML += `
      <div class="user">
        <div class="avatar">${username.charAt(0).toUpperCase()}</div>
        <div>
          <div style="font-weight:600">${username}</div>
          <div style="font-size:0.78rem;color:${username===me ? '#6ee7b7':'var(--muted)'}">${username===me?'You':'Online'}</div>
        </div>
      </div>
    `;
  });
}

function sendMessage() {
  const input = document.getElementById("inputMsg");
  const text = input.value.trim();
  if (!text) return;
  const message = { sender: me, content: text, time: new Date().toLocaleTimeString() };
  stompClient.send("/app/sendMessage", {}, JSON.stringify(message));
  input.value = "";
}

function showMessage(msg) {
  const messages = document.getElementById("messages");
  const wrapper = document.createElement("div");
  wrapper.className = "msg " + (msg.sender===me ? "me" : "other");
  wrapper.innerHTML = `<div class="meta">${msg.sender}</div><div class="text">${msg.content}</div><div class="time">${msg.time}</div>`;
  messages.appendChild(wrapper);
  messages.scrollTop = messages.scrollHeight;
}

// send message on Enter or button click
document.getElementById("sendBtn").addEventListener("click", sendMessage);
document.getElementById("inputMsg").addEventListener("keydown", e => { if(e.key==="Enter") sendMessage(); });

// notify backend when tab closes
window.addEventListener("beforeunload", () => {
  if(stompClient && stompClient.connected) {
    stompClient.send("/app/disconnectUser", {}, JSON.stringify({ sender: me }));
  }
});

connect();
</script>
</body>
</html>
